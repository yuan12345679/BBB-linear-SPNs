

\section{Preliminaries}
\label{sec:preliminary}

For an integer $m\geq1$, the set of all permutations on $\{0, 1\}^m$ will be denoted $\textsf{Perm}(m)$. A tweakable permutation with tweak space
$\mathcal{T}$ and message space $\mathcal{X}$ is a mapping $\widehat{P}:\mathcal{T}\times\mathcal{X}\rightarrow\mathcal{X}$ such that, for any tweak
$t\in\mathcal{T}$,
%
$$x\mapsto\widehat{P}(t,x)$$
%
is a permutation of $\mathcal{X}$. The set of all tweakable permutations with tweak space
$\mathcal{T}$ and message space $\{0, 1\}^m$ will be denoted $\widehat{\textsf{Perm}}(\mathcal{T},m)$.




\subsection{Tweakable Blockciphers}
\label{sec:prelim-tbc}

A keyed tweakable permutation with key space $\mathcal{K}$, tweak space $\mathcal{T}$ and message
space $\mathcal{X}$ is a mapping $T:\mathcal{K}\times\mathcal{T}\times\mathcal{X}\rightarrow\mathcal{X}$ such that, for any key $k\in\mathcal{K}$,
%
$$(t,x)\mapsto T(k,t,x).$$
%
is a tweakable permutation with tweak space $\mathcal{T}$ and message space $\mathcal{X}$.
%We
%will sometimes write $T(k, t, x)$ as Tk(t, x) or Tk,t(x). For an integer s  1,
%let t = (t1, . . . , ts) 2 T s, and let x = (x1, . . . , xs) 2 (X)s. We will write
%(T(k, ti, xi))1is as Tk(t, x) or Tk,t(x).



\subsection{(Tweakable) Linear Substitution-Permutation Networks}
\label{sec:prelim-tspn}

A \emph{substitution-permutation network} (SPN) defines a keyed permutation via repeated invocation of two transformations: blockwise computation of a public, cryptographic permutation called an ``S-box,'' and application of a keyed, non-cryptographic permutation. In this paper we will only introduce a model of linear SPNs. Formally, fix integers $n,r\geq1$. Let $\calK$ and $\calT$ be two
sets, and let $\bff= (f_0,...,f_r)$ be a $(r+1)$-tuple of functions from $\calK\times\calT$ to $\{0, 1\}^n$.

%The $r$-round tweakable Even-Mansour construction TEM[n, r, f] specifies, from an r-tuple P = (P1, . . . , Pr)
%of permutations of {0, 1}n, a tweakable block cipher with key space K, tweak space T , and
%message space {0, 1}n, simply denoted TEMP in the following (parameters [n, r, f] will always
%be clear from the context) which maps a key k 2 K, a tweak t 2 T , and a plaintext x 2 {0, 1}n
%to the ciphertext defined as (see Figure 1):




Formally, an r-round SPN taking inputs of length $w n$ where $w \in \mathcal{N}$ is the width of the network, is defined by $\mathnormal{r}+1$ keyed permutations $\left\{\pi_{i}: K_{i} \times\{0,1\}^{w n} \rightarrow\{0,1\}^{w n}\right\}_{i=0}^{r}$, a distribution $\mathcal{K}$ over $\mathcal{K}_{0} \times \dots \times \mathcal{K}_{r}$, and a permutation $\mathcal{S}:\{0,1\}^{n} \rightarrow \{0,1\}^{n}$. Given round keys $(k_{0},\dots, k_{r}) \in \mathcal{K}_{0} \times \dots \times \mathcal{K}_{r}$ and an input $x \in \{0,1\}^{w n}$, the output of the SPN is computed as follows

\begin{itemize}
  \item[--]
  Let $x_1 := x$.
  \item[--]
  For $i = 1$ to $r-1$ do:
  \begin{itemize}
  	\item[1.] $y_{i} := \overline{S_i}(x_{i}\xor tk_{i-1})$, where $\overline{S_i}(x[1]\xor tk_{i-1}[1]\|\cdots\| x[w]\xor tk_{i-1}[w]) \stackrel{\text { def }}{=} S_i(x[1]\xor tk_{i-1}[1])\|\cdots\| S_i(x[w]\xor tk_{i-1}[w])$.
    \item[2.] 
    $x_{i + 1} := T_i\cdot y_i$.
  \end{itemize}
  \item[--] $x_{r+1} := \overline{S_r}(x_r\xor tk_{r-1})\xor tk_r$.
  \item[--]
  The output is $x_{r+1}$.
\end{itemize}

Note that this model matches the structure of popular SPN ciphers such as the AES, Serpent, and the ISO/IEC lightweight standard PRESENT. Also note that our model follows~\cite[Sect. 4.2]{C:CDKLST18} and uses different $S$-boxes in different rounds. We remark that some other~\cite[Sect. 3]{C:CDKLST18} assumed the same $S$-box in every round. Finally, we refer to~\cite[Sect. 2.1]{EPRINT:DKSTZ17} for a more general model of SPNs and its connection to the above model.



We will mostly be interested in the case where
%K = ({0, 1}n)a and T = ({0, 1}n)b for
%integers a, b  1. In this setting, we will denote k = (k0, . . . , ka−1) and t = (t0, . . . , tb−1), all
%ki’s and tj ’s being n-bit strings, or simply k = k, resp. t = t when a = 1, resp. b = 1. When all
%fi’s are linear over ({0, 1}n)a+b,
we say that the construction has linear tweak and key mixing.




\subsection{The H-coefficient Technique}
Suppose that a distinguisher $\mathcal{D}$ makes $\mathnormal{p}$ queries to each of the S-boxes, and total $\mathnormal{q}$ queries to the construction oracles. The queries made to the construction oracle denoted $\mathcal{C}$, are recorded in a query history $$
\mathcal{Q}_{C} = (x_i,y_i)_{1 \leq i \leq q}
$$
where $\mathnormal{q}$ is the number of queries made to $\mathcal{C}$, and $(x_i,y_i)$ represents the evaluation obtained by the $\mathnormal{i}$ -th query to $\mathcal{C}$, So according to the instantiation, it implies either $\operatorname{SP}_k[\mathcal{S}](x_i) = y_i$  or $\mathcal{P}(x_i) = y_i$. For $j = 1,\cdots,r$, the queries made to $S_j$ are recorded in a query history

$$
\mathcal{Q}_{S_j} = (j, u_{j,i}, v_{j,i})_{1 \leq i \leq p}
$$
where $(j, u_{j,i}, v_{j,i})$  represents the evaluation $S_j(u_{j,i}) = v_{j,i}$ obtained by the $\mathnormal{i}$ -th query to $S_j$. Let
$$
\mathcal{Q}_{S}=\mathcal{Q}_{S_1} \cup \cdots \cup \mathcal{Q}_{S_r}
$$
Then the pair of query histories
$$
\tau = (\mathcal{Q}_{C}, \mathcal{Q}_{S})
$$
will be called the transcript of the attack: it contains all the information that  $\mathcal{D}$ has obtained at the end of the attack. In this work, we will only consider
information theoretic distinguishers. Therefore we can assume that a distinguisher is deterministic without making any redundant query, and hence the output of  $\mathcal{D}$  can be regarded as a function of $\tau$, denoted $\mathcal{D}(\tau)$ or $\mathcal{D}(\mathcal{Q}_C, \mathcal{Q}_S)$.\\

The adversarial goal is to tell apart the two worlds $\left(\operatorname{SP}_{\mathbf{k}}[\mathcal{S}],\mathcal{S}\right)$, and $\left(\mathcal{P},\mathcal{S}\right)$ by adaptively making forward and backward queries to each of the constructions and the S-boxes. Formally, $\mathcal{D}$ 's distinguishing advantage is defined by

\begin{equation}
\begin{aligned}
\operatorname{Adv}_{\mathrm{SP}}(\mathcal{D}) &=\operatorname{Pr}\left[\mathcal{P} \stackrel{s}{\leftarrow} \widehat{\operatorname{Perm}}(w n), \mathcal{S} \stackrel{\mathrm{s}}{\leftarrow} \operatorname{Perm}(n)^{r}: 1 \leftarrow \mathcal{D}^{\mathcal{S},\mathcal{P}}\right] \\
&-\operatorname{Pr}\left[\mathbf{k} \stackrel{s}{\leftarrow} \mathcal{K}^{r+1}, \mathcal{S} \stackrel{\mathrm{s}}{\leftarrow} \operatorname{Perm}(n)^{r}: 1 \leftarrow \mathcal{D}^{\mathcal{S}, \mathrm{SP}_{\mathrm{k}}[\mathcal{S}]}\right]
\end{aligned}
\end{equation}

for $p,q > 0$,we define

$$
\operatorname{Adv}_{\mathrm{SP}}(p, q)=\max _{\mathcal{D}} \operatorname{Adv}_{\mathrm{SP}}(\mathcal{D})
$$

We use the H-coefficient technique~\cite{SAC:Patarin08,EC:CheSte14} to prove various indistinguishability results. We provide a quick overview of its main ingredients here. Our presentation is essentially that of Chen and Steinberger~\cite{EC:CheSte14}; for further details, refer there or to the tutorial by Patarin~\cite{SAC:Patarin08}.
  Fix a distinguisher $\mathcal{D}$  that makes at most $\mathnormal{q}$ queries to its oracles. As in the security definition presented above, $\mathcal{D}$ 's  aim is to distinguish between two
worlds: a ``real world'' and an ``ideal world''. Assume without loss of generality that $\mathcal{D}$ is deterministic. The execution of $\mathcal{D}$  defines a transcript that includes the sequence of queries and answers received from its oracles; $\mathcal{D}$ 's output is a deterministic function of its transcript. Thus if $\mathnormal{X}$, $\mathnormal{Y}$ denote the probability distributions on transcripts induced by the real and ideal worlds, respectively, then $\mathcal{D}$ 's distinguishing advantage is upper bounded by the statistical distance

$$
\Delta(X, Y):=\frac{1}{2} \sum_{\tau}|\operatorname{Pr}[X=\tau]-\operatorname{Pr}[Y=\tau]|
$$

where the sum is taken over all possible transcripts $\tau$.
Let $\mathcal{T}$ denote the set of all transcripts that can be generated by $\mathcal{D}$ in either world. We look for a partition of $\mathcal{T}$  into two sets $\mathcal{T}_{1}$ and $\mathcal{T}_2$ of ``good'' and ``bad'' transcripts, respectively, along with a constant $\epsilon_{1} \in \left[0,1\right)$ such that

$$
\tau \in \mathcal{T}_{1} \Longrightarrow \operatorname{Pr}[X=\tau] / \operatorname{Pr}[Y=\tau] \geq 1-\epsilon_{1}
$$

It is then possible to show (see~\cite{EC:CheSte14} for details) that

$$
\Delta(X, Y) \leq \epsilon_{1}+\operatorname{Pr}\left[Y \in \mathcal{T}_{2}\right]
$$

For a transcript $\tau=\left(\mathcal{Q}_{C}, \mathcal{Q}_{S}\right)$, a key $k \in \mathcal{K}^{r+1}$, a permutation $\mathcal{P} \in \operatorname{Perm}( w n)$, a set of S-boxes $\mathcal{S} =\left(S_{1}, \ldots, S_{r}\right) \in \operatorname{Perm}( n)^{r}$ and $j \in \{1, \ldots, r\}$: if $S_{j}(u_{i})=v_{i}$ for every $i=1, \ldots, p$, then we will write $S_{j} \vdash \mathcal{Q}_{S_{j}}$. We will write $\mathcal{S} \vdash \mathcal{Q}_{S}$ if $S_{j} \vdash \mathcal{Q}_{S_{j}}$ for every $j \in \{1, \ldots, r\}$. Similarly, if $\operatorname{SP}_{\mathbf{k}}[\mathcal{S}]\left(x_{i}\right)=y_{i}$ (resp.$\mathcal{P}\left(x_{i}\right)=y_{i}$) for every $i=1, \ldots, q$, then we will write $\operatorname{SP}_{\mathbf{k}}[\mathcal{S}] \vdash \mathcal{Q}_{C}$(resp.$\mathcal{P} \vdash \mathcal{Q}_{C}$).\\

Then for $Y \in \mathcal{T}_{2}$, we have
$$
\begin{aligned}
&\operatorname{Pr}_{r e}(\tau, k) = \operatorname{Pr}\left[\mathbf{k} \stackrel{s}{\leftarrow} \mathcal{K}^{r+1}, \mathcal{S} \stackrel{\mathrm{s}}{\leftarrow} \operatorname{Perm}(n)^{r}: \operatorname{SP}_{\mathbf{k}}[\mathcal{S}] \vdash \mathcal{Q}_{C}, \mathcal{S} \vdash \mathcal{Q}_{S}\right]\\
&\operatorname{Pr}_{i d}(\tau, k) = \operatorname{Pr}\left[\mathcal{P} \stackrel{s}{\leftarrow} \widehat{\operatorname{Perm}}(w n), \mathcal{S} \stackrel{\mathrm{s}}{\leftarrow} \operatorname{Perm}(n)^{r}: \mathcal{P} \vdash \mathcal{Q}_{C}, \mathcal{S} \vdash \mathcal{Q}_{S}\right]\\
\end{aligned}
$$


\subsection{Indistinguishability in the Multi-user Setting}
We concentrate on the MU security with $\mathnormal{m}$  users. The SU security definition corresponds to the special case of $m=1$. Concretely, let $\mathrm{SP}_k[\mathcal{S}]$ be an $\mathnormal{r}$ -round SPN based on a set of S-boxes  $\mathcal{S}=(S_1, \cdots  ,S_r)$. In  the multi-user setting, let $\ell$ denote the number of users. In the real world $\ell$ secret keys  $k_1,\cdots ,k_{\ell} \in \mathcal{K}^{r+1}$  are chosen independently at random. A set of independent S-boxes $\mathcal{S}=(S_1, \cdots  ,S_r)$ is also randomly chosen from  $\operatorname{Perm(n)}^r$. A distinguisher $\mathcal{D}$  is given oracle access to $(\operatorname{SP}_{k_1}[\mathcal{S}], \cdots ,\operatorname{SP}_{k_{\ell}}[\mathcal{S}])$ as well as $\mathcal{S}=(S_1, \cdots  ,S_r)$. In the ideal world, $\mathcal{D}$ is given a set of independent random permutation $\mathcal{P} = (\operatorname{P}_1, \cdots ,\operatorname{P}_{\ell}) \in \widetilde{\operatorname{Perm}}(wn)^l$ instead of $(\operatorname{SP}_{k_1}[\mathcal{S}], \cdots ,\operatorname{SP}_{k_{\ell}}[\mathcal{S}])$. However, oracle access to $\mathcal{S}=(S_1, \cdots  ,S_r)$ is still allowed in the world. \\

The adversarial goal is to tell apart the two worlds, the $(\operatorname{SP}_{k_1}[\mathcal{S}], \cdots ,\operatorname{SP}_{k_l}[\mathcal{S}],\mathcal{S})$ and the ideal world $(\operatorname{P}_1, \cdots ,\operatorname{P}_{\ell},\mathcal{S})$ by adaptively making forward and backward queries to each of the constructions and the S-boxes. Formally, $\mathcal{D}$ 's distinguishing advantage is defined by
$$
\begin{aligned}
\operatorname{Adv}_{\mathrm{SP}}^{mu}(\mathcal{D}) &=\operatorname{Pr}\left[\widetilde{\operatorname{P}}_{1}, \ldots, \widetilde{\operatorname{P}}_{\ell} \stackrel{\mathrm{s}}{\leftarrow} \widetilde{\operatorname{Perm}}(w n)^l, \mathcal{S} \stackrel{\mathrm{s}}{\leftarrow} \operatorname{Perm}(n)^{r}: 1 \leftarrow \mathcal{D}^{\mathcal{S}, \widetilde{\operatorname{P}}_{1}, \ldots, \widetilde{\operatorname{P}}_{\ell}}\right] \\
&-\operatorname{Pr}\left[\mathbf{k}_{1}, \ldots, \mathbf{k}_{\ell} \stackrel{s}{\leftarrow} \mathcal{K}^{r+1}, \mathcal{S} \stackrel{s}{\leftarrow} \operatorname{Perm}(n)^{r}: 1 \leftarrow \mathcal{D}^{\mathcal{S}, \operatorname{SP}_{k_{1}}[\mathcal{S}], \ldots, \operatorname{SP}_{k_{\ell}}[\mathcal{S}]}\right]
\end{aligned}                                                                                                                                                                                                                        $$                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               for $p,q > 0$, we define

$$
\operatorname{Adv}^{mu}_{\mathrm{SP}}(p, q) = \max _{\mathcal{D}} \operatorname{Adv}_{\mathrm{SP}}(\mathcal{D})
$$
where the maximum is taken over all adversaries $\mathcal{D}$ making at most $\mathnormal{p}$ queries to each of the S-boxes and at most $\mathnormal{q}$ queries to the outer permutations. In the single-user setting with $\emph{l} = 1$. $\operatorname{Adv}^{mu}_{\mathrm{SP}}(\mathcal{D})$ and $\operatorname{Adv}^{mu}_{\mathrm{SP}}(p, q)$  will also be written as $\operatorname{Adv}^{su}_{\mathrm{SP}}(\mathcal{D})$ and $\operatorname{Adv}^{su}_{\mathrm{SP}}(p, q)$, respectively.







\medskip\noindent{\bf H-coefficient Technique.}
%
Fix a transcript $\tau = (\mathcal{Q}_C,\mathcal{Q}_S)$, a key $k \in \mathcal{K}^{r+1}$, a tweakable permutation $\widetilde{\mathcal{P}} \in \widetilde{\operatorname{Perm}}(\mathcal{T}, w n)$,  a set of S-boxes $\mathcal{S}=(S_1, \cdots  ,S_r) \in \operatorname{Perm}(n)^r $ and $j \in \{1, \cdots, \ell \}$. Let $k_1, \cdots ,k_{\ell} \in \mathcal{K}^{r+1}$ and $\mathcal{P} = (\operatorname{P}_1, \cdots ,\operatorname{P}_\ell) \in \widetilde{\operatorname{Perm}}(\mathcal{T},wn)^l$, if $\operatorname{SP}_{k_j}^{T}[\mathcal{S}] \vdash \mathcal{Q}_{C_j}$ (resp. $\mathcal{P}_j \vdash \mathcal{Q}_{C_j}$) for every $j = 1, \cdots ,\ell$, then we will write $(\operatorname{SP} ^{T}_{k_j}[\mathcal{S}])_{j = 1, \cdots ,\ell} \vdash \mathcal{Q}_C$ (resp. $\mathcal{P} \vdash \mathcal{Q}_{C_j}$).\\

If there exist $\widetilde{\mathcal{P}} \in \widetilde{\operatorname{Perm}}(\mathcal{T},w n)$ and $\mathcal{S} \in \operatorname{Perm}(\emph{n})^w$ that outputs $\tau$ at the end of the interaction with $\mathcal{D}$, then for an attainable transcript $\tau = (\mathcal{Q}_C,\mathcal{Q}_S)$, let

$$
\begin{aligned}
&\mathrm{p}_{1}\left(\mathcal{Q}_{C} | \mathcal{Q}_{S}\right)=\operatorname{Pr}\left[\widetilde{\mathcal{P}} \stackrel{s}{\leftarrow} \widetilde{{\operatorname{Perm}}}(\mathcal{T}, w n)^{\ell}, \mathcal{S} \stackrel{s}{\leftarrow} \operatorname{Perm}(n)^{r}: \widetilde{\mathcal{P}} \vdash \mathcal{Q}_{C} | \mathcal{S} \vdash \mathcal{Q}_{S}\right],\\
&\mathrm{p}_{2}\left(\mathcal{Q}_{C} | \mathcal{Q}_{S}\right)=\operatorname{Pr}\left[k_{1}, \ldots, k_{\ell} \stackrel{s}{\leftarrow} \mathcal{K}^{r+1}, \mathcal{S} \stackrel{s}{\leftarrow} \operatorname{Perm}(n)^{r}:\left(\mathrm{SP}_{k_{j}}^{T}[\mathcal{S}]\right)_{j} \vdash \mathcal{Q}_{C} | \mathcal{S} \vdash \mathcal{Q}_{S}\right].
\end{aligned}
$$
With these definitions, we can get the following lemma, the core of the H-coefficients technique (without defining ``bad'' transcripts).\\

\noindent \textbf{Lemma 1} \emph{Let $\epsilon \geq 0$, Suppose that for any attainable transcript $\tau = (\mathcal{Q}_C,\mathcal{Q}_S)$,}

$$
\mathrm{p}_{2}\left(\mathcal{Q}_{C} | \mathcal{Q}_{S}\right) \geq (1 - \epsilon) \mathrm{p}_{1}\left(\mathcal{Q}_{C} | \mathcal{Q}_{S}\right),
$$
\emph{Then one has}
$$
\operatorname{Adv}^{mu}_{\mathrm{SP}^T}(\mathcal{D}) \leq \epsilon.
$$

The lower bound is called \emph{$\epsilon$ -point-wise proximity} of the transcript $\tau = (\mathcal{Q}_C, \mathcal{Q}_S)$. The point-wise proximity of a transcript in the multi-user setting is guaranteed by the point-wise proximity of $(\mathcal{Q}_{C_{j}}, \mathcal{Q}_S)$ for each $j = 1, \cdots ,\ell$ in the single user setting. The following lemma is a restatement of Lemma 3  in ~\cite{hoang2016key}.

\begin{lemma}
\label{lemma:point-wise}

Let $\epsilon : \mathbb{N} \times \mathbb{N} \rightarrow \mathbb{R}^{\geq 0}$ be a function such that
	\begin{itemize}
		\item[1.]
		$\epsilon (x, y) + \epsilon (x, z) \leq \epsilon (x, y + z)$ for every $x, y, z \in \mathbb{N}$,
		\item[2.]
		$\epsilon (\cdot, z)$ and $\epsilon (z, \cdot)$ are non-decreasing functions on $\mathbb{N}$ for every $z \in \mathbb{N}$.
	\end{itemize}
Suppose that for any distinguisher $\mathcal{D}$ in the single-user setting that makes p primitive queries to each of the underlying S-boxes and makes q construction queries, and for any attainable transcript $\tau = (\mathcal{Q}_C, \mathcal{Q}_S)$ obtained by $\mathcal{D}$, one has
%
$$
\mathrm{p}_{2}\left(\mathcal{Q}_{C} | \mathcal{Q}_{S}\right) \geq (1 - \epsilon(p,q)) \mathrm{p}_{1}\left(\mathcal{Q}_{C} | \mathcal{Q}_{S}\right).
$$
%
Then for any distinguisher $\mathcal{D}$ in the multi-user setting that makes $\mathnormal{p}$ primitive queries to each of the underlying S-boxes and makes total $\mathnormal{q}$ construction queries, and for any attainable transcript $\tau = (\mathcal{Q}_C, \mathcal{Q}_S)$ obtained by $\mathcal{D}$, one has
%
$$
\mathrm{p}_{2}\left(\mathcal{Q}_{C} | \mathcal{Q}_{S}\right) \geq (1 - \epsilon(p + wq,q)) \mathrm{p}_{1}\left(\mathcal{Q}_{C} | \mathcal{Q}_{S}\right).
$$
\end{lemma}



For any extended transcript $\tau^{\prime} = (\mathcal{Q}_C, \mathcal{Q}_S, \mathcal{Q}_S^{\prime},k)$, where $\mathcal{Q}_{S}^{(1)} = \mathcal{Q}_S \cup \mathcal{Q}_S^{\prime}$, denote

$$
\mathrm{p}\left(\tau^{\prime}\right)=\operatorname{Pr}\left[\mathcal{S} \stackrel{\mathrm{s}}{\leftarrow} \operatorname{Perm}(n)^{2}: \mathrm{\operatorname{SP}}^{T}_{k}[\mathcal{S}] \vdash \mathcal{Q}_{C} |\left(S_{1} \vdash \mathcal{Q}_{S_{1}}^{(1)}\right) \wedge\left(S_{2} \vdash \mathcal{Q}_{S_{2}}^{(1)}\right)\right].
$$

Then we will get the following lemma:

\begin{lemma}
\label{lemma:ratio-2-rounds}

For any good extended transcript $\tau^{\prime}$, one has
$$
\left(2^{w n}\right)_{q} \mathrm{p}\left(\tau^{\prime}\right) \geq 1-\frac{q^{2}}{2^{w n}}-\frac{q\left(2 w p+6 w^{2} q\right)^{2}}{2^{2 n}}.
$$
\end{lemma}


